{% extends "base.html" %}

{% set active_tab = "data" %}
{% block title %}Data Browser - Strategy Lab{% endblock %}

{% block main_class %}flex h-[calc(100vh-3.5rem)]{% endblock %}

{% block content %}
<!-- Sidebar -->
<aside class="w-72 flex-shrink-0 bg-gray-800 border-r border-gray-700 flex flex-col overflow-hidden">
    <div class="px-4 py-3 border-b border-gray-700 flex-shrink-0">
        <span class="text-sm font-semibold text-gray-300 uppercase tracking-wide">Data Browser</span>
    </div>
    <div class="flex-1 overflow-y-auto p-3" id="data-tree" hx-get="/data/tree" hx-trigger="load" hx-swap="innerHTML">
        <div class="text-gray-500 text-sm px-2">Loading...</div>
    </div>
</aside>

<!-- Main: Data Preview -->
<div class="flex-1 overflow-y-auto p-6">
    <div id="data-preview" class="max-w-6xl mx-auto">
        <div class="text-center text-gray-500 py-20">
            <div class="text-4xl mb-3">ðŸ“Š</div>
            <p>Select a dataset from the tree to preview</p>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Toggle collapsible tree nodes
function toggleNode(el) {
    const children = el.nextElementSibling;
    const chevron = el.querySelector('.chevron');
    if (children) {
        children.classList.toggle('hidden');
        if (chevron) {
            chevron.textContent = children.classList.contains('hidden') ? 'â–¶' : 'â–¼';
        }
    }
}

// Load preview: all months for an interval
function loadPreview(venue, market, ticker, interval) {
    const url = `/data/preview/${venue}/${market}/${ticker}/${interval}`;
    htmx.ajax('GET', url, '#data-preview');
    highlightActive(venue, market, ticker, interval, null);
}

// Load preview: single month
function loadMonth(venue, market, ticker, interval, period) {
    const url = `/data/preview/${venue}/${market}/${ticker}/${interval}?periods=${period}`;
    htmx.ajax('GET', url, '#data-preview');
    highlightActive(venue, market, ticker, interval, period);
}

// Highlight the active item
function highlightActive(venue, market, ticker, interval, period) {
    document.querySelectorAll('.tree-item-active').forEach(el => {
        el.classList.remove('tree-item-active', 'bg-gray-700');
    });
    const id = period
        ? `month-${venue}-${market}-${ticker}-${interval}-${period}`
        : `interval-${venue}-${market}-${ticker}-${interval}`;
    const el = document.getElementById(id);
    if (el) {
        el.classList.add('tree-item-active', 'bg-gray-700');
    }
}
</script>
{% endblock %}
